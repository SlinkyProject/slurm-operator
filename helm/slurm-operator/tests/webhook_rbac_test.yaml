# yaml-language-server: $schema=https://raw.githubusercontent.com/helm-unittest/helm-unittest/main/schema/helm-testsuite.json
---
suite: test webhook rbac
templates:
- webhook/rbac.yaml
chart:
  version: 1.2.3
  appVersion: 1.2.3
release:
  name: test-release
  namespace: test-namespace

tests:
- it: manifest should match snapshot
  asserts:
  - matchSnapshot: {}

- it: should not render when disabled
  set:
    webhook:
      enabled: false
  asserts:
  - hasDocuments:
      count: 0

- it: should not render when serviceAccount.create is false
  set:
    webhook:
      serviceAccount:
        create: false
  asserts:
  - hasDocuments:
      count: 0


- it: should set namespace
  documentSelector:
    path: kind
    value: ServiceAccount
  set:
    namespaceOverride: custom-namespace
  asserts:
  - equal:
      path: metadata.namespace
      value: custom-namespace


- it: should set serviceAccount name
  documentSelector:
    path: kind
    value: ServiceAccount
  set:
    webhook:
      serviceAccount:
        name: custom-service-account
  asserts:
  - equal:
      path: metadata.name
      value: custom-service-account
